var Imprint=function(c){"use strict";class h{constructor(t){this.buffer=[],this.config=t,this.flushInterval=window.setInterval(()=>this.flush(),5e3),document.addEventListener("visibilitychange",()=>{document.visibilityState==="hidden"&&this.flush()}),window.addEventListener("beforeunload",()=>{this.flush()})}add(t){this.buffer.push(t),this.buffer.length>=50&&this.flush()}flush(){if(this.buffer.length===0)return;const t=[...this.buffer];this.buffer=[];const e=this.config.ingestUrl||"https://api.imprint.cloud/v1/spans";navigator.sendBeacon?(new Blob([JSON.stringify(t)],{type:"application/json"}),fetch(e,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${this.config.publicKey}`},body:JSON.stringify(t),keepalive:!0}).catch(n=>console.error("Imprint flush failed",n))):fetch(e,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${this.config.publicKey}`},body:JSON.stringify(t)}).catch(n=>console.error("Imprint flush failed",n))}}class p{constructor(t){this.activeSpan=null,this.config=t,this.transport=new h(t),this.traceId=this.getInitialTraceId()}getInitialTraceId(){const t=document.querySelector('meta[name="imprint-trace-id"]');return t?t.getAttribute("content")||this.generateId(32):this.generateId(32)}generateId(t){const e="0123456789abcdef";let n="";for(let a=0;a<t;a++)n+=e[Math.floor(Math.random()*e.length)];return n}startSpan(t,e,n="internal"){const a={trace_id:this.traceId,span_id:this.generateId(16),parent_id:e||(this.activeSpan?this.activeSpan.span_id:void 0),namespace:this.config.serviceName||window.location.hostname,name:t,kind:n,start_time:new Date().toISOString(),duration_ns:0,status_code:0};return new u(a,this.transport)}setActiveSpan(t){this.activeSpan=t}getActiveSpan(){return this.activeSpan}currentTraceHeader(){return this.activeSpan?`00-${this.traceId}-${this.activeSpan.span_id}-01`:""}event(t,e){var a;const n={trace_id:this.traceId,span_id:this.generateId(16),parent_id:(a=this.activeSpan)==null?void 0:a.span_id,namespace:this.config.serviceName||window.location.hostname,name:t,kind:"event",start_time:new Date().toISOString(),duration_ns:0,status_code:0};e&&Object.keys(e).length>0&&(n.error_data=JSON.stringify(e)),this.transport.add(n)}}class u{constructor(t,e){this.span=t,this.transport=e,this.startTime=performance.now()}end(){const t=performance.now()-this.startTime;this.span.duration_ns=Math.round(t*1e6),this.transport.add(this.span)}setStatus(t){this.span.status_code=t}recordError(t){this.span.error_data=t instanceof Error?t.message+`
`+t.stack:String(t)}get id(){return this.span.span_id}get traceId(){return this.span.trace_id}get raw(){return this.span}}function f(r){const t=window.fetch;window.fetch=async function(e,n){const a=typeof e=="string"?e:e instanceof URL?e.toString():e.url,S=`FETCH ${(n==null?void 0:n.method)||"GET"} ${a}`,i=r.startSpan(S,void 0,"client"),o=r.currentTraceHeader();o&&(n||(n={}),n.headers||(n.headers={}),n.headers instanceof Headers?n.headers.set("traceparent",o):Array.isArray(n.headers)?n.headers.push(["traceparent",o]):n.headers.traceparent=o);try{const s=await t(e,n);return i.setStatus(s.status),i.end(),s}catch(s){throw i.recordError(s),i.end(),s}}}function l(r){let t=null;function e(){t&&t.end();const a=window.location.pathname;t=r.startSpan(`PAGE ${a}`),r.setActiveSpan(t.raw)}e();const n=history.pushState;history.pushState=function(...a){n.apply(this,a),e()},window.addEventListener("popstate",()=>{e()})}function g(r){window.addEventListener("error",t=>{const e=r.startSpan("CRASH");e.recordError(t.error||t.message),e.end()}),window.addEventListener("unhandledrejection",t=>{const e=r.startSpan("UNHANDLED_PROMISE");e.recordError(t.reason),e.end()})}function d(r){const t=new p(r);return l(t),f(t),g(t),t}return typeof window<"u"&&(window.Imprint={init:d}),c.init=d,Object.defineProperty(c,Symbol.toStringTag,{value:"Module"}),c}({});
